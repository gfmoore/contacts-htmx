{% extends 'index.html' %}

{% block content %}

<form action="/contacts" method="get">
  <label for="search"></label>
  <input id="search" type="search" name="q" value="{{ request.args.get('q') or '' }}">
  <input type="submit" value="Search" />
</form>

<p>
  <a href="/contacts/new">Add Contact</a>
</p>

<table>
  <thead>
    <tr>
      <th>First</th>
      <th>Last</th>
      <th>Phone</th>
      <th>Email</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    {% for contact in contacts %}
    <tr>
      <td>{{ contact.first }}</td>
      <td>{{ contact.last }}</td>
      <td>{{ contact.phone }}</td>
      <td>{{ contact.email }}</td>
      <td>
        <button id=edit-btn
          hx-get="/contacts/{{ contact.id }}/edit"
          hx-push-url="true"
          hx-target="body">
          Edit
        </button>
        
        <button id="delete-btn"
          hx-delete="/contacts/{{ contact.id }}"
          hx-push-url="true"
          hx-confirm="Are you sure you want to delete this contact?"
          hx-target="body">
          Delete
        </button>
        
        <button id=view-btn
          hx-get="/contacts/{{ contact.id }}"
          hx-push-url="true"
          hx-target=body>
          View
        </button>
      </td>
    </tr>
    {% endfor %}
    {% if contacts|length == 10 %}
      <tr>
        <td>
          <span 
            hx-target="closest tr"
            hx-trigger="revealed"
            hx-swap="outerHTML"
            hx-select="tbody > tr"
            hx-get="/contacts?page={{ page + 1 }}">
            Loading more...
        </span>
        </td>
      </tr>
    {% endif %}
  </tbody>
</table>

<!-- <div>
  <span>
    {% if page > 1 %}
      <a href=/contacts?page={{ page - 1}}>Prev</a>
    {% endif %}
    {% if contacts|length == 10 %}  
      <a href=/contacts?page={{ page + 1}}>Next</a>
    {% endif %}
  </span>
</div> -->

{% endblock %}